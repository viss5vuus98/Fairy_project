@model IEnumerable<Fairy_project.Models.Exhibitionss>

@section Style
    {
    <link rel="stylesheet" href="~/css/Report.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/style_back.css" asp-append-version="true">
        @*    <link rel="stylesheet" href="~/css/bootstrap-admin.css">*@
    <link rel="stylesheet" type="text/css"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    }
    @{
    Layout = "_Admin_Layout";
}
<style>
    .hrline {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    hr {
        flex: 1;
        border: none;
        height: 2px;
        background: black;
    }

    .form-control:focus {
        border-color: #BBB;
        box-shadow: none;
    }

    #datepicker {
        cursor: pointer;
    }

        #datepicker:hover {
            background-color: #CCC;
        }

    select:hover {
        border-color: #5C5858;
    }

</style>
<div class="container">
    <div class="row">
        <div class="col-12 mt-3">
            <div class="accordion accordion-header-border-bottom" id="accordionHeaderBorderBottom">
                <div class="card my-1">
                    <div id="collapseBorderBottomOne" class="collapse show" aria-labelledby="headingBorderBottomOne"
                         data-parent="#accordionHeaderBorderBottom">
                        <div class="d-flex">
                            <div class="col-3">
                                <select class="form-control rounded-0 bg-light" id="year">
                                    <option>年</option>
                                    @{
                                        for (int i = DateTime.Now.Year; i < DateTime.Now.AddYears(10).Year; i++)
                                        {
                                            <option value="@i">@i</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="col-3">
                                <select class="form-control rounded-0 bg-light" id="month">
                                    <option value="">月</option>
                                    @{
                                        for (int i = 1; i < 13; i++)
                                        {
                                            <option value="@i">@i 月</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="col-6">
                                <select class="form-control rounded-0 bg-light" id="ename">
                                    <option value="">展覽名稱</option>
                                    @{
                                        foreach (var ename in ViewBag.ename)
                                        {
                                            <option value="@ename">@ename</option>
                                        }

                                    }

                                </select>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div id="headingBorderBottomOne">
            <div class="hrline">
                <hr>
                <button class="btn p-0 px-2" type="button" data-toggle="collapse"
                        data-target="#collapseBorderBottomOne" aria-expanded="true"
                        aria-controls="collapseBorderBottomOne">
                    搜尋
                </button>
                <hr>
            </div>
        </div>
    </div>


    <div class="row py-2 mb-3">
        <div class="col-8">
            <h2 class="m-0">NAMMMMMMMMMMM</h2>
        </div>
        <div class="col-4">
            <p>454654646</p>
        </div>
    </div>
    <div class="row align-items-start justify-content-center my-1">
        <div class="col-lg-4 col-12">
            <div class="card card-default">
                <div class="card-header">
                    <h2>入場比例</h2>
                </div>
                <div class="card-body">
                    <div class="progress progress-sm rounded-0 mb-2">
                        <div class="progress-bar bg-secondary" role="progressbar" style="width: 67%"
                             aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-dark text-capitalize">入場人數 / 售出票數</span>
                        <span class="text-dark text-capitalize">80%</span>
                    </div>
                </div>
            </div>
            <div class="card card-default">
                <div class="card-header">
                    <h2>承租比例</h2>
                </div>
                <div class="card-body">
                    <div class="progress progress-sm rounded-0 mb-2">
                        <div class="progress-bar bg-secondary" role="progressbar" style="width: 90%"
                             aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-dark text-capitalize">承租攤位數 / 開放攤位數</span>
                        <span class="text-dark text-capitalize">80%</span>
                    </div>
                </div>
            </div>            <!-- <button type="button" class="btn btn-light w-100 border border-1">Button</button> -->

        </div>

        <div class="col-lg-4 col-12">
            <div class="card card-default">
                <div class="d-flex p-5 justify-content-lg-start">
                    <i class="fa-solid fa-person fa-3x align-self-center me-5 my-3"></i>
                    <div class="text-left">
                        <p>平均入場人數</p>
                        <span class="h4 d-block m-0">8930人</span>
                    </div>
                </div>
            </div>
            <div class="card card-default">
                <div class="d-flex p-5 justify-content-lg-start">
                    <i class="fa-solid fa-dollar-sign fa-3x align-self-center me-5 my-3"></i>
                    <div class="text-left">
                        <p>總收益</p>
                        <span class="h4 d-block m-0">$8930</span>
                    </div>
                </div>
            </div>
            <!-- <button type="button" class="btn btn-light w-100 border border-1">Button</button> -->
        </div>

        <div class="col-lg-3 col-12 text-center">
            <canvas class="border border-1 rounded-3 p-3" id="myChart"></canvas>
            <input type="text" class="w-100 border-0 border-bottom text-center py-2 my-4" id="datepicker"
                   placeholder="選擇日期">

        </div>
    </div>
    <div class="row d-flex justify-content-center">
        <div class="col-lg-8 col-12">
            <canvas id="myChart2" class="align-self-center"></canvas>
        </div>
    </div>
</div>
@section Scripts

    {

    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.2/chart.min.js"
        integrity="sha512-zjlf0U0eJmSo1Le4/zcZI51ks5SjuQXkU0yOdsOBubjSmio9iCUp8XPLkEAADZNBdR9crRy3cniZ65LF2w8sRA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        $('#year').on('change', (e) => {
            $('#ename').html('<option value="">展覽名稱</option>')
            changedate();
        })
        $('#month').on('change', (e) => {
            $('#ename').html('<option value="">展覽名稱</option>')
            changedate();
        })
        $('#ename').on('change', (e) => {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("ReportShow")',
                data: {
                    ename:$(e.target).val(),
                },
            }).done((result) => {

            }).fail(() => {
                console.log("pagefail")
            })

        })

        function changedate() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("DateSearchExhibition")',
                data: {
                    year: $('#year').val(),
                    month: $('#month').val(),
                },
            }).done((result) => {
                let ename = Array.from(result.ename)
                htmlstr = '<option value="">展覽名稱</option>'
                for (let i = 0; i < ename.length; i++) {
                    htmlstr += `<option value="${ename[i]}">${ename[i]}</option>`
                }
                $('#ename').html(htmlstr)
            }).fail(() => {
                console.log("pagefail")
            })
        }


        new Litepicker({
            element: document.getElementById('datepicker'),
            singleMode: false,
            tooltipText: {
                one: 'night',
                other: 'nights'
            },
            tooltipNumber: (totalDays) => {
                return totalDays - 1;
            }
        })

        let chartStatus = Chart.getChart("myChart");
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var ctx = document.getElementById('myChart');
        var myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: [
                    'Red',
                    'Blue',
                ],
                datasets: [{
                    label: 'My First Dataset',
                    data: [300, 50],
                    backgroundColor: [
                        'rgb(255, 99, 132)',
                        'rgb(54, 162, 235)',
                    ],
                    height: '500px',
                    hoverOffset: 4,
                }]
            },
        });

        let chartStatus2 = Chart.getChart("myChart2");
        if (chartStatus2 != undefined) {
            chartStatus2.destroy();
        }
        var ctx2 = document.getElementById('myChart2');
        var myChart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ['1,', '2', '5', '5', '5', '5', '5', '5', '5', '5', '5', '5', '5', '5', '5', '5'],
                datasets: [{
                    label: '進場人數',
                    data: [300, 50, 90, 50, 50, 50, 50, 50],
                    backgroundColor: [
                        '#5C5858',
                    ],
                    borderWidth: 0,
                }]
            },
            options: {
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true
                    }
                }
            }
        });

    </script>

    }